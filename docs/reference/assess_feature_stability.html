<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Assess the stability for configurations of feature types and sizes — assess_feature_stability • ClustAssess</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Assess the stability for configurations of feature types and sizes — assess_feature_stability"><meta property="og:description" content="Evaluate the stability of clusterings obtained
based on incremental subsets of a given feature set."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ClustAssess</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/ClustAssess.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/comparing-soft-and-hierarchical.html">Comparing soft and hierarchical clusterings with element-centric similarity</a>
    </li>
    <li>
      <a href="../articles/stability-dim-reduction-flexibility.html">Flexibility of the dimensionality reduction assessment</a>
    </li>
    <li>
      <a href="../articles/stability-pipeline-description.html">Stability-based parameter assessment</a>
    </li>
    <li>
      <a href="../articles/stability-pipeline-shiny.html">Automatic ClustAssess pipeline. Generating the ClustAssess shiny-app</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/Core-Bioinformatics/ClustAssess/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Assess the stability for configurations of feature types and sizes</h1>
    <small class="dont-index">Source: <a href="https://github.com/Core-Bioinformatics/ClustAssess/blob/HEAD/R/stability-1-dim-reduction.R" class="external-link"><code>R/stability-1-dim-reduction.R</code></a></small>
    <div class="hidden name"><code>assess_feature_stability.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Evaluate the stability of clusterings obtained
based on incremental subsets of a given feature set.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">assess_feature_stability</span><span class="op">(</span></span>
<span>  <span class="va">data_matrix</span>,</span>
<span>  <span class="va">feature_set</span>,</span>
<span>  <span class="va">steps</span>,</span>
<span>  <span class="va">feature_type</span>,</span>
<span>  <span class="va">resolution</span>,</span>
<span>  n_repetitions <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  seed_sequence <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  graph_reduction_type <span class="op">=</span> <span class="st">"PCA"</span>,</span>
<span>  ecs_thresh <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  matrix_processing <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">dt_mtx</span>, <span class="va">actual_npcs</span> <span class="op">=</span> <span class="fl">30</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>     <span class="va">actual_npcs</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">actual_npcs</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">dt_mtx</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span><span class="fl">2</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">RhpcBLASctl</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RhpcBLASctl/man/RhpcBLASctl-package.html" class="external-link">blas_set_num_threads</a></span><span class="op">(</span><span class="fu">foreach</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/foreach/man/getDoParWorkers.html" class="external-link">getDoParWorkers</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="va">embedding</span> <span class="op">&lt;-</span></span>
<span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dt_mtx</span>, rank. <span class="op">=</span> <span class="va">actual_npcs</span><span class="op">)</span><span class="op">$</span><span class="va">x</span></span>
<span>    </span>
<span>    <span class="fu">RhpcBLASctl</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RhpcBLASctl/man/RhpcBLASctl-package.html" class="external-link">blas_set_num_threads</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">embedding</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">dt_mtx</span><span class="op">)</span></span>
<span>   </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">embedding</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"PC_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">embedding</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">embedding</span><span class="op">)</span></span>
<span> <span class="op">}</span>,</span>
<span>  umap_arguments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  prune_value <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>  clustering_algorithm <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  clustering_arguments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-data-matrix">data_matrix<a class="anchor" aria-label="anchor" href="#arg-data-matrix"></a></dt>
<dd><p>A data matrix having the features on the rows
and the observations on the columns.</p></dd>


<dt id="arg-feature-set">feature_set<a class="anchor" aria-label="anchor" href="#arg-feature-set"></a></dt>
<dd><p>A set of feature names that can be found on the rownames
of the data matrix.</p></dd>


<dt id="arg-steps">steps<a class="anchor" aria-label="anchor" href="#arg-steps"></a></dt>
<dd><p>Vector containing the sizes of the subsets; negative values will
be interpreted as using all features.</p></dd>


<dt id="arg-feature-type">feature_type<a class="anchor" aria-label="anchor" href="#arg-feature-type"></a></dt>
<dd><p>A name associated to the feature_set.</p></dd>


<dt id="arg-resolution">resolution<a class="anchor" aria-label="anchor" href="#arg-resolution"></a></dt>
<dd><p>A vector containing the resolution values used for
clustering.</p></dd>


<dt id="arg-n-repetitions">n_repetitions<a class="anchor" aria-label="anchor" href="#arg-n-repetitions"></a></dt>
<dd><p>The number of repetitions of applying the pipeline with
different seeds; ignored if seed_sequence is provided by the user. Defaults
to <code>100</code>.</p></dd>


<dt id="arg-seed-sequence">seed_sequence<a class="anchor" aria-label="anchor" href="#arg-seed-sequence"></a></dt>
<dd><p>A custom seed sequence; if the value is NULL, the
sequence will be built starting from 1 with a step of 100. Defaults to
<code>NULL</code>.</p></dd>


<dt id="arg-graph-reduction-type">graph_reduction_type<a class="anchor" aria-label="anchor" href="#arg-graph-reduction-type"></a></dt>
<dd><p>The graph reduction type, denoting if the graph
should be built on either the PCA or the UMAP embedding. Defaults to <code>PCA</code>.</p></dd>


<dt id="arg-ecs-thresh">ecs_thresh<a class="anchor" aria-label="anchor" href="#arg-ecs-thresh"></a></dt>
<dd><p>The ECS threshold used for merging similar clusterings. We
recommend using the 1 value. Defaults to <code>1</code>.</p></dd>


<dt id="arg-matrix-processing">matrix_processing<a class="anchor" aria-label="anchor" href="#arg-matrix-processing"></a></dt>
<dd><p>A function that will be used to process the data
matrix
by using a dimensionality reduction technique. The function should have
one parameter, the data matrix, and should return an embedding describing the
reduced space. By default, the function will use the precise PCA method with
<code>prcomp</code>.</p></dd>


<dt id="arg-umap-arguments">umap_arguments<a class="anchor" aria-label="anchor" href="#arg-umap-arguments"></a></dt>
<dd><p>A list containing the arguments that will be passed
to the UMAP function. Refer to the <code><a href="https://jlmelville.github.io/uwot/reference/umap.html" class="external-link">uwot::umap</a></code> function for more details.</p></dd>


<dt id="arg-prune-value">prune_value<a class="anchor" aria-label="anchor" href="#arg-prune-value"></a></dt>
<dd><p>Argument indicating whether to prune the SNN graph. If the
value is 0, the graph won't be pruned. If the value is between 0 and 1, the
edges with weight under the pruning value will be removed. If the value is
-1, the highest pruning value will be calculated automatically and used.</p></dd>


<dt id="arg-clustering-algorithm">clustering_algorithm<a class="anchor" aria-label="anchor" href="#arg-clustering-algorithm"></a></dt>
<dd><p>An index indicating which community detection
algorithm will be used: Louvain (1), Louvain refined (2), SLM (3) or
Leiden (4). More details can be found in the Seurat's
<code>FindClusters</code> function.</p></dd>


<dt id="arg-clustering-arguments">clustering_arguments<a class="anchor" aria-label="anchor" href="#arg-clustering-arguments"></a></dt>
<dd><p>A list containing the arguments that will be
passed to the community detection algorithm, such as the number of iterations
and the number of starts. Refer to the Seurat's <code>FindClusters</code> function
for more details.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>A boolean indicating if the intermediate progress will
be printed or not.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A list having one field associated with a step value. Each step
contains a list with three fields:</p><ul><li><p>ecc - the EC-Consistency of the partitions obtained on all repetitions</p></li>
<li><p>embedding - one UMAP embedding generated on the feature subset</p></li>
<li><p>most_frequent_partition - the most common partition obtained across
repetitions</p></li>
</ul></div>
    <div id="note">
    <h2>Note</h2>
    <p>The algorithm assumes that the feature_set is already sorted when
performing the subsetting based on the steps values. For example, if the
user wants to analyze highly variable feature set, they should provide them
sorted by their variability.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2024</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># create an artificial expression matrix</span></span></span>
<span class="r-in"><span><span class="va">expr_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="fl">10</span>, min <span class="op">=</span> <span class="fl">3</span>, max <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    nrow <span class="op">=</span> <span class="fl">200</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">expr_matrix</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">200</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">expr_matrix</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"feature"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">feature_stability_result</span> <span class="op">&lt;-</span> <span class="fu">assess_feature_stability</span><span class="op">(</span></span></span>
<span class="r-in"><span>    data_matrix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">expr_matrix</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    feature_set <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">expr_matrix</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    steps <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>    feature_type <span class="op">=</span> <span class="st">"feature_name"</span>,</span></span>
<span class="r-in"><span>    resolution <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    n_repetitions <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>    umap_arguments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        <span class="co"># the following parameters are used by the umap function</span></span></span>
<span class="r-in"><span>        <span class="co"># and are not mandatory</span></span></span>
<span class="r-in"><span>        n_neighbors <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>        approx_pow <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>        n_epochs <span class="op">=</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>        init <span class="op">=</span> <span class="st">"random"</span>,</span></span>
<span class="r-in"><span>        min_dist <span class="op">=</span> <span class="fl">0.3</span></span></span>
<span class="r-in"><span>    <span class="op">)</span>,</span></span>
<span class="r-in"><span>    clustering_algorithm <span class="op">=</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_feature_overall_stability_boxplot.html">plot_feature_overall_stability_boxplot</a></span><span class="op">(</span><span class="va">feature_stability_result</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="assess_feature_stability-1.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Andi Munteanu, Arash Shahsavari, Miguel Larraz Lopez de Novales, Irina Mohorianu.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

