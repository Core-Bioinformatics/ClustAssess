<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tools for Assessing Clustering • ClustAssess</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Tools for Assessing Clustering">
<meta property="og:description" content="A set of tools for evaluating clustering robustness using proportion of ambiguously clustered pairs (Senbabaoglu et al. (2014) &lt;doi:10.1038/srep06207&gt;), as well as similarity across methods and method stability using element-centric clustering comparison (Gates et al. (2019) &lt;doi:10.1038/s41598-019-44892-y&gt;). Additionally, this package enables stability-based parameter assessment for graph-based clustering pipelines typical in single-cell data analysis.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">ClustAssess</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="articles/ClustAssess.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/comparing-soft-and-hierarchical.html">Comparing soft and hierarchical clusterings with element-centric similarity</a>
    </li>
    <li>
      <a href="articles/stability-dim-reduction-flexibility.html">Flexibility of the dimensionality reduction assessment</a>
    </li>
    <li>
      <a href="articles/stability-pipeline-description.html">Stability-based parameter assessment</a>
    </li>
    <li>
      <a href="articles/stability-pipeline-shiny.html">Automatic ClustAssess pipeline. Generating the ClustAssess shiny-app</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Core-Bioinformatics/ClustAssess/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="contents col-md-9">

<div class="section level1">
<div class="page-header"><h1 id="clustassess-tools-for-assessing-clustering">ClustAssess: Tools for Assessing Clustering<a class="anchor" aria-label="anchor" href="#clustassess-tools-for-assessing-clustering"></a>
</h1></div>
<p><a href="https://github.com/r-hub/cranlogs.app" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/ClustAssess" alt="rstudio mirror downloads"></a> <a href="https://github.com/r-hub/cranlogs.app" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/grand-total/ClustAssess" alt="rstudio mirror downloads"></a></p>
<p>This repo contains the ClustAssess R package, which provides a set of tools for evaluating clustering robustness.</p>
<ul>
<li>
<a href="#the-tools">The Tools</a><ul>
<li><a href="#proportion-of-ambiguously-clustered-pairs-pac">Proportion of Ambiguously Clustered Pairs (PAC)</a></li>
<li><a href="#element-centric-clustering-similarity-ecs">Element Centric Clustering Similarity (ECS)</a></li>
<li><a href="#marker-gene-overlap">Marker Gene Overlap</a></li>
<li><a href="#stability-based-parameter-assessment">Stability-Based Parameter Assessment</a></li>
</ul>
</li>
<li><a href="#handling-large-datasets">Handling Large Datasets</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#citing-clustassess">Citing ClustAssess</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>
<div class="section level1">
<h1 id="the-tools">The Tools<a class="anchor" aria-label="anchor" href="#the-tools"></a>
</h1>
<p><img src="https://raw.githubusercontent.com/Core-Bioinformatics/ClustAssess/release-1.0.0/man/figures/ClustAssess_diagram_all.png" width="80%/"></p>
<div class="section level2">
<h2 id="proportion-of-ambiguously-clustered-pairs-pac">Proportion of Ambiguously Clustered Pairs (PAC)<a class="anchor" aria-label="anchor" href="#proportion-of-ambiguously-clustered-pairs-pac"></a>
</h2>
<p>To assess clustering robustness, the proportion of ambiguously clustered pairs (PAC) [1] uses a consensus clustering. The rate of element co-clustering is recorded across various numbers of clusters, <em>k</em>. The lower the PAC, the stabler the clustering for that <em>k</em>.</p>
<p>ClustAssess uses a heirarchical clustering as base for the consensus clustering, and an optimized Rcpp [2] implementation to compute the PAC values. To calculate PAC, we write:</p>
<p><code>cc_res = consensus_cluster(your_data, n_reps=50, k_max=20, p_sample=0.8, p_feature=0.8)</code></p>
<p>It is important that the PAC has converged before using it to assess your data; the <code>pac_convergence</code> function can be used to visualize the PAC curves across iterations:</p>
<p><img src="https://raw.githubusercontent.com/Core-Bioinformatics/ClustAssess/release-1.0.0/docs/articles/ClustAssess_files/figure-html/pac-1.png" width="80%/"></p>
<p>As the curves have evened out, we surmize that PAC has converged in this case. If the PAC has not converged, increase the <code>n_reps</code> value.</p>
<p>If the dataset contains &gt;1000 elements, we recommend calculating a geometric sketch [3] of your data of size &lt;1000, and running PAC on that sketch.</p>
<p>A local minimum in the PAC landscape, as visualized below using the <code>pac_landscape</code> function, can be interpreted as an optimal <em>k</em> for the dataset:</p>
<p><img src="https://raw.githubusercontent.com/Core-Bioinformatics/ClustAssess/release-1.0.0/docs/reference/pac_landscape-1.png" width="80%/"></p>
</div>
<div class="section level2">
<h2 id="element-centric-clustering-similarity-ecs">Element Centric Clustering Similarity (ECS)<a class="anchor" aria-label="anchor" href="#element-centric-clustering-similarity-ecs"></a>
</h2>
<p>Element-centric similarity (ECS) [4] is a per-observation measure of clustering similarity. Briefly, ECS is obtained by constructing a cluster-induced element graph, and subsequently calculating the stationary probability distribution of a random walk with restarts (also known as a personalized Pagerank) over the elements.</p>
<p>In addition to providing per-element information on clustering agreement, ECS avoids several pitfalls associated with other measures of clustering similarity (refer to [4] for more detail).</p>
<p>To compare two clusterings with ECS, we use the <code>element_sim_elscore</code> function:</p>
<p><code>ecs = element_sim_elscore(clustering_result1, clustering_result2, alpha=0.9)</code></p>
<p>where <code>1-alpha</code> is the restart probability of the random walk. We can subsequently visualize the ECS on a PCA of the data:</p>
<p><img src="https://raw.githubusercontent.com/Core-Bioinformatics/ClustAssess/release-1.0.0/docs/articles/comparing-soft-and-hierarchical_files/figure-html/ecs-2.png" width="80%/"></p>
<p>In addition to flat disjoint clusterings (like the result of k-means for example), ClustAssess can also compare overlapping clusterings and hierarchical clusterings; refer to the <code>comparing-soft-and-hierarchical</code> vignette for more detail.</p>
<p>Besides comparing two clusterings with <code>element_sim_elscore</code>, ClustAssess also enables computing the per-element consistency (aka frustration) between a set of clusterings with the <code>element_consistency</code> function, and comparing a set of clusterings with a ground truth partitioning of elements with the <code>element_agreement</code> function.</p>
</div>
<div class="section level2">
<h2 id="marker-gene-overlap">Marker Gene Overlap<a class="anchor" aria-label="anchor" href="#marker-gene-overlap"></a>
</h2>
<p>In the analysis of single-cell RNA-seq data, cluster marker genes are typically used to infer the cell type of clusters. However, two different clustering results may lead to two different sets of markers for the cells. The <code>marker_overlap</code> function allows the comparison of two sets of markers. The output can be either as the number of common marker genes per cell, or as Jaccard similarity (size of intersect divided by size of union) per cell.</p>
<p><img src="https://raw.githubusercontent.com/Core-Bioinformatics/ClustAssess/release-1.0.0/docs/articles/ClustAssess_files/figure-html/jsi-1.png" width="80%/"></p>
</div>
<div class="section level2">
<h2 id="stability-based-parameter-assessment">Stability-Based Parameter Assessment<a class="anchor" aria-label="anchor" href="#stability-based-parameter-assessment"></a>
</h2>
<p>The most common clustering pipeline for single-cell data consists of constructing a nearest-neighbor graph of the cells, followed by community detection to obtain the clustering. This pipeline is available in multiple single-cell toolkits, including Seurat, Monocle v3, and SCANPY. ClustAssess provides several methods to assess the stability of parameter choices that influence the final clustering, for example to evaluate feature sets, we use <code>get_feature_stability_object</code>, and plot the results with <code>plot_feature_stability_boxplot</code>:</p>
<p><img src="https://raw.githubusercontent.com/Core-Bioinformatics/ClustAssess/release-1.0.0/docs/articles/stability-based-parameter-assessment_files/figure-html/stab_boxplot-1.png" width="80%/"></p>
<p>where the higher element-centric consistency (ECC) indicates more stable clustering results across random seeds. For more details, please see <a href="https://core-bioinformatics.github.io/ClustAssess/articles/stability-based-parameter-assessment.html" class="external-link">this vignette</a>.</p>
</div>
<div class="section level2">
<h2 id="interactive-visualization-of-the-stability-assessment-and-downstream-analysis">Interactive Visualization of the Stability Assessment and Downstream Analysis<a class="anchor" aria-label="anchor" href="#interactive-visualization-of-the-stability-assessment-and-downstream-analysis"></a>
</h2>
<p><img src="https://raw.githubusercontent.com/Core-Bioinformatics/ClustAssess/release-1.0.0/man/figures/ClustAssess_app_supp.png" height="40%/"></p>
<p>Another feature of the package consists in providing a Shiny application where the user can interactively visualize the stability assessment of the clustering and perform some downstream analysis steps on the dataset without prior R knwoledge. The application is divided into three major components: - Stability Assessments: the user is presented with the assessment of the clustering stability for each of the three steps of the PhenoGraph pipeline. This component is structured in three tabs, one for each step. The user is prompted to select the stable configurations in order to proceed to the next section. - Comparison of configuration and downstream analysis: the user can visually assess the clustering results and the pattern on expression based on the variety of visualisations provided in this section, which contains UMAP plots, violin and boxplots, gene expression pseudobulk heatmap and bubbleplots, metadata association heatmaps. The biological interpretation is enhanced by the possibility of identifying the marker genes for each cluster and the enrichment analysis of the detected differentially expressed genes. The app allows custom annotation of the clusters and the already existing metadata. - Sandbox: this tab provides more flexibility for the user in temrs of the selected configuration. This approach is available, but not encouraged, as the results might not be stable and reproducible. This tab also contains elements such as panels for changing the colourscheme of the figures.</p>
<p>The application can be generated using the output of the <code>automatic_stability_assessment</code> function and a normalised expression matrix.</p>
</div>
</div>
<div class="section level1">
<h1 id="handling-large-datasets">Handling Large Datasets<a class="anchor" aria-label="anchor" href="#handling-large-datasets"></a>
</h1>
<p>If your dataset is large, the runtime for the tools described above may be prohibitive. In these cases, we recommend subsampling your data using geometric sketching [3]. In R, the subsampling can be done via reticulate:</p>
<p><code>geosketch &lt;- reticulate::import('geosketch')</code></p>
<p>assuming data.embed contains a dimensionality reduction of your data, you can then call:</p>
<p><code>sketch.indices &lt;- geosketch$gs(data.embed, sketch.size, one_indexed = TRUE)</code></p>
<p>and use the resulting indices for your subsample. For PAC, subsampling to &lt;1000 cells should help, and for ECS and data assessment functions, &lt;5000 cells may be appropriate (and parallelization can further help reduce the runtime).</p>
</div>
<div class="section level1">
<h1 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h1>
<p>ClustAssess can be installed from <a href="https://cran.r-project.org/index.html" class="external-link">CRAN</a>:</p>
<p><code>install.packages("ClustAssess")</code></p>
<p>or from github using remotes:</p>
<p><code>remotes::install_github("Core-Bioinformatics/ClustAssess")</code></p>
<p>The following packages are required for ClustAssess:</p>
<ul>
<li>ComplexHeatmap</li>
<li>dplyr</li>
<li>DT</li>
<li>fastcluster</li>
<li>foreach</li>
<li>glue</li>
<li>Gmedian</li>
<li>ggnewscale</li>
<li>ggplot2</li>
<li>ggrastr</li>
<li>ggrepel</li>
<li>ggtext</li>
<li>gprofiler2</li>
<li>igraph</li>
<li>jsonlite</li>
<li>Matrix (&gt;= 1.5.0)</li>
<li>matrixStats</li>
<li>methods</li>
<li>progress</li>
<li>stringr</li>
<li>paletteer</li>
<li>plotly</li>
<li>qualpalr</li>
<li>RANN</li>
<li>reshape2</li>
<li>rlang</li>
<li>shiny</li>
<li>shinyjs</li>
<li>shinyLP</li>
<li>shinyWidgets</li>
<li>stats</li>
<li>uwot</li>
<li>vioplot</li>
</ul>
<p>To use all stability-based assessment methods, and run all examples and vignettes, the following packages are also needed:</p>
<ul>
<li>colourpicker</li>
<li>dbscan</li>
<li>DelayedMatrixStats</li>
<li>dendextend</li>
<li>devtools</li>
<li>doParallel</li>
<li>doRNG</li>
<li>e1071</li>
<li>knitr</li>
<li>leidenbase</li>
<li>monocle3</li>
<li>patchwork</li>
<li>ragg</li>
<li>reactlog</li>
<li>rhdf5</li>
<li>rmarkdown</li>
<li>RhpcBLASctl</li>
<li>scales</li>
<li>Seurat</li>
<li>SeuratData</li>
<li>SeuratObject</li>
<li>SharedObject</li>
<li>styler</li>
</ul>
<p><em>Note</em>: Please check the other branches as well for the latest development version.</p>
</div>
<div class="section level1">
<h1 id="citing-clustassess">Citing ClustAssess<a class="anchor" aria-label="anchor" href="#citing-clustassess"></a>
</h1>
<p>If you have used ClustAssess in your work, please cite <a href="https://doi.org/10.1101/2022.01.31.478592" class="external-link">Shahsavari et al. 2022</a>:</p>
<pre><code>Shahsavari, A., Munteanu, A., &amp; Mohorianu, I. (2022). ClustAssess: Tools for Assessing the Robustness of Single-Cell Clustering. bioRxiv. https://doi.org/10.1101/2022.01.31.478592</code></pre>
<p>or in BibTex:</p>
<pre><code>@ARTICLE{clustassess,
  title     = "ClustAssess: Tools for Assessing the Robustness of Single-Cell Clustering",
  author    = "Shahsavari, Arash and Munteanu, Andi and Mohorianu, Irina",
  journal   = "bioRxiv",
  year      =  2022,
  url       = "https://doi.org/10.1101/2022.01.31.478592",
  language  = "en"
}</code></pre>
</div>
<div class="section level1">
<h1 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h1>
<p>[1] Șenbabaoğlu, Y., Michailidis, G., &amp; Li, J. Z. (2014). Critical limitations of consensus clustering in class discovery. Scientific reports, 4(1), 1-13. <a href="https://doi.org/10.1038/srep06207" class="external-link uri">https://doi.org/10.1038/srep06207</a></p>
<p>[2] Eddelbuettel, D., &amp; Balamuta, J. J. (2018). Extending R with C++: A brief introduction to Rcpp. The American Statistician, 72(1), 28-36. <a href="https://doi.org/10.1080/00031305.2017.1375990" class="external-link uri">https://doi.org/10.1080/00031305.2017.1375990</a></p>
<p>[3] Hie, B., Cho, H., DeMeo, B., Bryson, B., &amp; Berger, B. (2019). Geometric sketching compactly summarizes the single-cell transcriptomic landscape. Cell systems, 8(6), 483-493. <a href="https://doi.org/10.1016/j.cels.2019.05.003" class="external-link uri">https://doi.org/10.1016/j.cels.2019.05.003</a></p>
<p>[4] Gates, A. J., Wood, I. B., Hetrick, W. P., &amp; Ahn, Y. Y. (2019). Element-centric clustering comparison unifies overlaps and hierarchy. Scientific reports, 9(1), 1-13. <a href="https://doi.org/10.1038/s41598-019-44892-y" class="external-link uri">https://doi.org/10.1038/s41598-019-44892-y</a></p>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=ClustAssess" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/Core-Bioinformatics/ClustAssess/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/Core-Bioinformatics/ClustAssess/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing ClustAssess</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Andi Munteanu <br><small class="roles"> Author, maintainer </small>  </li>
<li>Arash Shahsavari <br><small class="roles"> Author </small>  </li>
<li>Miguel Larraz Lopez de Novales <br><small class="roles"> Author </small>  </li>
<li>Irina Mohorianu <br><small class="roles"> Author </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Andi Munteanu, Arash Shahsavari, Miguel Larraz Lopez de Novales, Irina Mohorianu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
